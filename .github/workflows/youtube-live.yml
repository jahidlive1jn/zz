name: Non-Stop 24/7 YouTube Live Stream

on:
  schedule:
    # à¦ªà§à¦°à¦¤à¦¿ 4 à¦˜à¦¨à§à¦Ÿà¦¾à¦¯à¦¼ à¦à¦•à¦¬à¦¾à¦° - overlap à¦¨à¦¿à¦¶à§à¦šà¦¿à¦¤ à¦•à¦°à¦¤à§‡
    - cron: '0 */4 * * *'    # 00:00, 04:00, 08:00, 12:00, 16:00, 20:00
    - cron: '30 */4 * * *'   # 00:30, 04:30, 08:30, 12:30, 16:30, 20:30
    - cron: '15 1-23/4 * * *'  # 01:15, 05:15, 09:15, 13:15, 17:15, 21:15
    - cron: '45 2-23/4 * * *'  # 02:45, 06:45, 10:45, 14:45, 18:45, 22:45
  
  workflow_dispatch:  # Manual trigger option
  
  push:
    branches: [ main ]

jobs:
  stream:
    runs-on: ubuntu-latest
    timeout-minutes: 330  # 5.5 à¦˜à¦¨à§à¦Ÿà¦¾ (overlap à¦à¦° à¦œà¦¨à§à¦¯)
    
    # Concurrency control - same stream can run multiple times
    concurrency:
      group: youtube-stream-${{ github.run_id }}
      cancel-in-progress: false  # Don't cancel running streams
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v3
      
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ Install FFmpeg (Optimized)
        run: |
          echo "ğŸ“¦ Installing FFmpeg with optimizations..."
          sudo apt-get update -qq
          sudo apt-get install -y --no-install-recommends ffmpeg
          echo "âœ… FFmpeg installed!"
          ffmpeg -version | head -n 1
      
      - name: ğŸ“š Install Python Dependencies
        run: |
          echo "ğŸ“š Installing dependencies..."
          pip install --upgrade pip --quiet
          pip install -r requirements.txt --quiet
          echo "âœ… Dependencies ready!"
      
      - name: ğŸ¬ Start Non-Stop YouTube Live Stream
        env:
          YOUTUBE_STREAM_KEY: ${{ secrets.YOUTUBE_STREAM_KEY }}
          VIDEO_URL: ${{ secrets.VIDEO_URL }}
          VIDEO_QUALITY: ${{ secrets.VIDEO_QUALITY }}
        run: |
          echo "=================================================="
          echo "ğŸ¬ NON-STOP 24/7 YouTube Live Stream"
          echo "=================================================="
          echo "â° Start time: $(date '+%Y-%m-%d %H:%M:%S %Z')"
          echo "ğŸŒ Server: GitHub Actions (ubuntu-latest)"
          echo "ğŸ’» Your PC: Can be OFF!"
          echo "ğŸ”„ This run: Will stream for ~5.5 hours"
          echo "ğŸ“… Next run: Already scheduled (overlap mode)"
          echo "=================================================="
          python streamer.py
      
      - name: ğŸ“Š Stream Summary
        if: always()
        run: |
          echo "=================================================="
          echo "ğŸ“Š Stream Session Completed"
          echo "=================================================="
          echo "â° End time: $(date '+%Y-%m-%d %H:%M:%S %Z')"
          echo "ğŸ”„ Next stream: Already running or starting soon"
          echo "âœ… Status: Normal completion"
          echo "=================================================="
          echo ""
          echo "ğŸ’¡ Multiple workflows run simultaneously to ensure"
          echo "   24/7 coverage with no gaps!"
          echo "=================================================="
